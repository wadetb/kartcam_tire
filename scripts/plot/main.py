import matplotlib.pyplot as plt
import numpy as np

log = '''
00> [00:00:20.424,468] <inf> lis3dhtr: PACKET: 36857E7E8081818080817F807F817F81818180807F807F8080808080807F817D837F8181827F7F80807F7F8080818080808080807F8080817F80808180807D838080808080807F80817F817F8080817F808080817F80807F827F808080FF805387807F7F808080818080817F7F807F818081817F807F807F8180817F807F7C85817F817F817F808081807F8080808180808080807F7F808081807F81807B8480818080807F81808081807F8080807F817F80817F81807F80817F8180FF80E27F80807F8081807F808082807F807F81817E80808180808080807F808080827F7F818082807F7F808080807F81808080818080807F7F81817F817F8180807E8180817F80807F8081808080807F8180807F81807F8180817F817F8080
00> --- 1 messages dropped ---
00> [00:00:22.290,924] <inf> lis3dhtr: PACKET: 3682807F81808080807F80807F8180808080817F808081807F7F8181807F807F81808080807F8180808080808080808080807F80808180817F80808080807F81808080817F81807F807F817F8081808080808080807F8180807F828080FF80538480817E80818080808080817E8180807F8180807F81807F80808080817E7E8280808180817F8080808080808080807F8181807F7F818081808080
00> 11[00:00:03.543,151] <inf> lis3dhtr: PACKET: 3581808081827F7F7E7F807F817F82818180807E80808080808181807F80807F8080818080807F808180817F8080817F807F817F8080818080817F8080807F8080807F808081817F8180817F81807F80807F80807F81827F808180807FFF80537E807F82817F8081808080827F8181807F807F7F807E81818080817F80817F81808081807E817F817F80817F807F808180807F8180808081817F807F80807F817F817F81808081807F817F80807F807F80818181808180807F807F81FF80E2807F81807F81817F807F818180807E8180817F808080808080808080808080807F8180807F8080817F80817F817F808080818080807F80827F808080817F817E8080807F82808080817F81807F807F8081807F81808080817F81807F
00> --- 1 messages dropped ---
00> [00:00:05.409,759] <inf> lis3dhtr: PACKET: 358080817F8180808080808080807F81807F8080818080807F81808080807F80818080807F818080807F818080807F8080808180807F80808080818080807F817F8081807F81817F807F81807F8080817F8180807F817F81807F808180FF8053817F807F818080817F817F8180807F80808081807F808081817F7F80807F818080817F8081807F818080807F808080817F80817F817F817F808080817F8080808081817F7F8180807F80817F8180807F818080808080807F7F818081FF80E28180807E817F827F7F81808080807F808180807F818081807F807F8081808080817F80817F8080807F808180817F817F8080818080807E82807F808080808080807F81807F818080807F8080827F7F808180817F807F80817F828080
00> --- 1 messages dropped ---
00> [00:00:07.276,031] <inf> lis3dhtr: PACKET: 3580817F7F80808181818080807F8080807F80808080808080817F81817F807F817F817F80818080807F80808080817F8080807F80818080807F8181817F7F81808080807F808180807F81807F808180807F81817F807F80817F818080FF8053817F7F817F8180808081807F81808080808080808080807F817F808080817F807F808080818080808081807F80817F8080808080807F8180808080808080817F80808080808080817F817F7F8081808080808080818080807F80817FFF80E27F8181807F8080807F8181817E8180807F7F80818080808080817E8081817F81817F7F807F8080827F80807F827F8081807F80808180807F808080807F81808080807F8180818080807F80808080817F817F808080808180807F7F80
00> --- 1 messages dropped ---
00> [00:00:09.142,333] <inf> lis3dhtr: PACKET: 35818080807F81807F808081807F808080817F827E81817F8080808080807F808080817F8081808080807F8180808080817F80808080817F80817F7F808080817F8080808081808081807F807F80817F81808080808080808080808080FF80538080818080807F80808081807F818080808080807F80808080808180807F80808080817F7F81807F818180807F80817F8080807F8180817F807F81808080808080817F80817F808080807F81808080817F80817F808080818080807FFF80E27F8080818080807F81817F818080807F818080807F8081807E81808080808080807F818080808180807F80808080808080818080807F7F808181807F7F8181807F80817F81807F817F8080808080807F8081807F8081817F80808080
00> --- 1 messages dropped ---
00> [00:00:11.008,819] <inf> lis3dhtr: PACKET: 3581808180817F7F7F80808180808080808080807F817F808081808080807F8081807F8081807F808080808080808180807F8080807F81817F81807F80808080808080808180807F818080817E817F80807F8180808080808180808080FF805380817F8081807F7F80808181808080807F8080808081807F808081807F808080817F7F808180808080817F81807F8080807F818080808080808080808080817F8081807F80817F817F80817F80808080808081808080807F80818080FF80E280817F81807F80807F80817F80817F8081817F7F818080808080817F80817F808080807F82807E817F817F827F807F817F8180827F7F818080817E7F818080808080817F808081807F7F818080817F8080817F808080808080808180
00> [00:00:12.875,335] <inf> lis3dhtr: PACKET: 35817F8081807F817F7F81808080818080807F808080817F8180807F8180807F817F817F8080817F8080817F8080817F80808080817F8081808080807F808080808080817F808180807F8180807F80808180807F818080807F80817F80FF805381807F80817F80817F8080808080808080808180807F808080808081807F808080817F8080817F817F80808081807F8080808080817F80808080807F818080808080818080807F80818080808080807F808080808080818080808080FF80E2807F81817F817F8081807F7F828080807F817F80808180807F817F80808080808080807F81817F80807F818080817E817F81807F81807F81808080817F80808080817F80808180807F808080808080817F80807F80818080817F8080
00> [00:00:14.741,790] <inf> lis3dhtr: PACKET: 35CD8283837F7E7E7D7E7E7D8083817F8280807E7D7F84847E7D7F8282808035CD818382848588838384878984827D8688898786878182817E7C7E7B797CFF7FB5FF80498481827F7D797A767779777174757C8083858595909294908E868B908D3D808282808285868682828182807F82827F818382838380807E7C7C797A7C6F8F7C7D7C7976797B7E7E787C7F807F7F7C7A7675787C7F838C9293938F887A897F7F7C808284898989898E8A867F7A787A75766B71786870838170727EFF80E28B827E81838283848080848285827F848582828080837F7D7A7A77777478826F7B7D7979797C7E7C7A7D7F7D7C7D88838683838E94908E92929394908B0FF5807F7A77787879777578757172716E7376787B847E866D7A8283777885
00> --- 3 messages dropped ---
00> [00:00:16.608,245] <inf> lis3dhtr: PACKET: 35FF80738085858685878886817D787A7D7D7D7D7D7B7B7D79777A737478747A7914E782888A8A868587888D8A867E8088878E87837D7C7C7C7D7B7A7A7B7E7FFF7FB5FF806C7F7E7D777977787676767A7E82878A898C89868182848786838786898D4342797F7B7E757B817F828C908F8A888887898A8B8C8A888C8D8E8D87848014E0777572706D6E6F6D72737B7D7B7679747E8084848A888E8F8E8F8B8B896FA2888A8B8B898A8787837D78787470706E6B6D6F7578777B79787572727DFF80E221888C90928C929196918D8F8887868181807C7C7F7976797C7678716E6C8C54747574777575767C7F80888A838B8B939093928F8B90908E8C8A8886831BE7807F7A7977756D6A6B6D6C6E6E7074747477787E83828B888B8B8E8D96
00> --- 1 messages dropped ---
00> [00:00:18.474,578] <inf> lis3dhtr: PACKET: 35F185817E83858788898C919193918789827B76747777787A7C75797D7D78FF7FB5FE7173777D868D8D8B8B8B8A878785858585868183808080807D78787473FF7FB5FF8040797D808485807D7C808386868989898989868889878783827F7B7675735DDC7D7875737372716E6E726F6E6C74707A85868B929494918E908F91939337DA85827F7B747371707274777678787A787675777A7C8088929895938F8C5BB680827F7D7D7C7D7A7977777374767978797779797A8081858A8E8E8F8FFF80E29B86868081818583818084817D78737172716E6C7177777A8080878D8F92A56686888787888584848785808483827F7C797879787A7A7D7F81837E7C7C8D667A7D7E7F878483828785848183858483807F7E7C7C7D7C7B7A7B787C7D
00> --- 1 messages dropped ---
00> [00:00:20.340,850] <inf> lis3dhtr: PACKET: 35B37D92A6AFAEAB9B8B7561605653556278848FA3B3B8B5A494756463635DFF7FB5EB666B7A838C9BA4ABACA39580726B696362646B73767C7F8691979F9C9BFF7FB5FF80AF817672706D65626365717E88919AA0A0A8A89C907D706A665C5A626D7AB5FF80F37B64514B484B5C7394AAB5C2C7BB9F856D584F423E45586D8597A1B2B665FD9E9082746557524C505667808D9AA6A9ABA39991867F77736B66605D5EAF237C8A959FACAFB3AA9589776A5C58585651515E6C7D91A7BCC4C2AF96846D7A757778757C83838886868F8B8D8B8475716F6A737D8289877C7B838A918B9387817C737276757A7F827C80807E858B8B8683817C7978757A7B777C81B44E8487878B8B928E87817874737375787D7F817D7F7F8188898C8E898180
00> --- 1 messages dropped ---
00> [00:00:22.207,244] <inf> lis3dhtr: PACKET: 35A591A9BDC7C5B38B604F4240465B7591A0A19C98918B857F777575747576FF7FB5FF803D82848185807F7D7D7F818687858380797B767476798184848888837F7BFF7FB5EF7775807C76868E86858581726B6A7084827773787F8481828081C16659FF8053FF8106754537313B547599B5BFC1B2A086716E6A696B747D82838585838282805DA2807F85868381807E7D7E8083838282848481818285858385817E80807E32C67A7A808289877D808888827E7172758B7571727681828A818281828595D8F277675F70777A6A5B69707178767A8B8E9B98918D8986887E7B7C7E7C79906E8289907B797A7A7B787D83808383817E7C77787B7C8185878A8984847E8F586B7D7485A1857A8A8C837D7D7C7B82818D857B797C808B8D8A86908081
00> --- 1 messages dropped ---
'''

lines = log.strip().split('\n')
packets = []
for line in lines:
    if 'PACKET:' in line:
        packet_str = line.split('PACKET:')[1].strip()
        packets.append(packet_str)

data = np.empty((0, 3), dtype=np.float32)

for packet in packets:
    packet_data = []
    last_s = 0
    i = 0
    while i < len(packet):
        byte_str = packet[i:i+2]
        byte_val = int(byte_str, 16)
        if byte_val == 0xff:
            s = int(packet[i+2:i+6], 16) - 32768
            i += 6
        else:
            s = last_s + (byte_val - 128)
            i += 2
        packet_data.append(s)
        last_s = s

    packet_data = np.array(packet_data)
    n = len(packet_data) // 3
    print(f'packet length: {len(packet_data)}, n: {n}')
    x = packet_data[0:n]
    y = packet_data[n:2*n]
    z = packet_data[2*n:3*n]
    packet_data = np.vstack((x, y, z)).T
    packet_data = packet_data.astype(np.float32)

    data = np.vstack((data, packet_data))

# print(data)

ax = plt.figure().add_subplot(projection='3d')

ax.scatter(data[:, 0], data[:, 1], data[:, 2], c='b', marker='o', label='accel data')

ax.legend()
ax.set_xlabel('X')
ax.set_ylabel('Y')
ax.set_zlabel('Z')

ax.view_init(elev=20., azim=-35, roll=0)

plt.show()
